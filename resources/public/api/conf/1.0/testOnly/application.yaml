openapi: 3.0.3
info:
  version: 0.110.0
  title: Pillar 2 API
  description: An API for managing and retrieving data in accordance with Pillar 2 tax rules.
tags: []
paths:
  /organisations/pillar-two/setup/organisation:
    post:
      operationId: createTestOrganisation
      tags:
      - setup
      summary: Create Test Organisation
      parameters:
      - in: header
        name: Authorization
        required: true
        schema:
          type: string
        description: Bearer token for authentication
      - in: header
        name: X-Pillar2-Id
        required: true
        schema:
          type: string
        description: "Pillar 2 Id - Pattern: [A-Z0-9]{1,15}"
      - in: header
        name: Accept
        required: false
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        description: "Specifies the expected response format as versioned JSON from the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.organisation.TestOrganisation"
            examples:
              CreateTestOrganisationRequestExample:
                $ref: "#/components/examples/requests.TestOrganisationRequestExample"
      responses:
        "201":
          description: Test Organisation Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.organisation.TestOrganisationWithId"
              examples:
                CreateTestOrganisationResponseExample:
                  $ref: "#/components/examples/responses.TestOrganisationResponseExample"
        "400":
          description: Invalid Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Invalid JSON:
                  $ref: "#/components/examples/errors.InvalidJson"
                Empty Body:
                  $ref: "#/components/examples/errors.EmptyBody"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Unauthorized:
                  $ref: "#/components/examples/errors.TestOrg.Unauthorized"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Forbidden:
                  $ref: "#/components/examples/errors.TestOrg.Forbidden"
        "409":
          description: Organisation Already Exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: 409
                message: "Organisation with pillar2Id: XAPLR1234567890 already exists"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: 500
                message: Failed to create organisation due to database error
      description: |
        Creates a test organisation associated with your authed organisation.
      security:
      - userRestricted:
        - write:pillar2
    get:
      operationId: getTestOrganisation
      tags:
      - setup
      summary: Get Test Organisation
      parameters:
      - in: header
        name: Authorization
        required: true
        schema:
          type: string
        description: Bearer token for authentication
      - in: header
        name: X-Pillar2-Id
        required: true
        schema:
          type: string
        description: "Pillar 2 Id - Pattern: [A-Z0-9]{1,15}"
      - in: header
        name: Accept
        required: false
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        description: "Specifies the expected response format as versioned JSON from the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
      responses:
        "200":
          description: Test Organisation Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.organisation.TestOrganisationWithId"
              examples:
                TestOrganisationResponseExample:
                  $ref: "#/components/examples/responses.TestOrganisationResponseExample"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Unauthorized:
                  $ref: "#/components/examples/errors.TestOrg.Unauthorized"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Forbidden:
                  $ref: "#/components/examples/errors.TestOrg.Forbidden"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Not Found:
                  $ref: "#/components/examples/errors.TestOrg.NotFound"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: 500
                message: Internal Server Error
        "400":
          description: Invalid Request
          content:
            application/json:
              examples:
                Invalid JSON:
                  $ref: "#/components/examples/errors.InvalidJson"
                Empty Body:
                  $ref: "#/components/examples/errors.EmptyBody"
      description: |
        Gets a test organisation associated with your authed organisation.
      security:
      - userRestricted:
        - read:pillar2
    put:
      operationId: updateTestOrganisation
      tags:
      - setup
      summary: Update Test Organisation
      parameters:
      - in: header
        name: Authorization
        required: true
        schema:
          type: string
        description: Bearer token for authentication
      - in: header
        name: X-Pillar2-Id
        required: true
        schema:
          type: string
        description: "Pillar 2 Id - Pattern: [A-Z0-9]{1,15}"
      - in: header
        name: Accept
        required: false
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        description: "Specifies the expected response format as versioned JSON from the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.organisation.TestOrganisation"
            examples:
              UpdateTestOrganisationRequestExample:
                $ref: "#/components/examples/requests.TestOrganisationRequestExample"
      responses:
        "200":
          description: Test Organisation Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.organisation.TestOrganisationWithId"
              examples:
                UpdateTestOrganisationResponseExample:
                  $ref: "#/components/examples/responses.TestOrganisationResponseExample"
        "400":
          description: Invalid Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Invalid JSON:
                  $ref: "#/components/examples/errors.InvalidJson"
                Empty Body:
                  $ref: "#/components/examples/errors.EmptyBody"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Unauthorized:
                  $ref: "#/components/examples/errors.TestOrg.Unauthorized"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Forbidden:
                  $ref: "#/components/examples/errors.TestOrg.Forbidden"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Not Found:
                  $ref: "#/components/examples/errors.TestOrg.NotFound"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: 500
                message: Failed to update organisation due to database error
      description: |
        Updates a test organisation associated with your authed organisation.
      security:
      - userRestricted:
        - write:pillar2
    delete:
      operationId: deleteTestOrganisation
      tags:
      - setup
      summary: Delete Test Organisation
      parameters:
      - in: header
        name: Authorization
        required: true
        schema:
          type: string
        description: Bearer token for authentication
      - in: header
        name: X-Pillar2-Id
        required: true
        schema:
          type: string
        description: "Pillar 2 Id - Pattern: [A-Z0-9]{1,15}"
      - in: header
        name: Accept
        required: false
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        description: "Specifies the expected response format as versioned JSON from the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
      responses:
        "204":
          description: Test Organisation and Submission Data Deleted Successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Unauthorized:
                  $ref: "#/components/examples/errors.TestOrg.Unauthorized"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Forbidden:
                  $ref: "#/components/examples/errors.TestOrg.Forbidden"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Not Found:
                  $ref: "#/components/examples/errors.TestOrg.NotFound"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: 500
                message: Failed to delete organisation and submission data
      description: |
        Deletes a test organisation associated with your authed organisation.
      security:
      - userRestricted:
        - write:pillar2
  /organisations/pillar-two/uk-tax-return:
    post:
      operationId: submitUKTR
      tags:
      - submission
      summary: SubmitUKTR
      parameters:
      - in: header
        name: Authorization
        required: true
        schema:
          type: string
        description: Bearer token for authentication
      - in: header
        required: true
        name: X-Pillar2-Id
        schema:
          type: string
        description: Pillar2 ID for the submission
      - in: header
        name: Accept
        required: false
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        description: "Specifies the expected response format as versioned JSON from the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
              - $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.UKTRSubmissionData"
              - $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.UKTRSubmissionNilReturn"
            examples:
              NilReturnMneAndUk:
                $ref: "#/components/examples/requests.UKTRNilReturnMneAndUk"
              NilReturnDomesticOnlyWithUkGaap:
                $ref: "#/components/examples/requests.UKTRNilReturnDomesticOnlyWithUkGaap"
              NilReturnDomesticOnlyWithoutUkGaap:
                $ref: "#/components/examples/requests.UKTRNilReturnDomesticOnlyWithoutUkGaap"
              LiabilityReturnMneAndUkOneEntity:
                $ref: "#/components/examples/requests.UKTRLiabilityReturnMneAndUkWithOneEntity"
              LiabilityReturnMneAndUkTwoEntities:
                $ref: "#/components/examples/requests.UKTRLiabilityReturnMneAndUkWithTwoEntities"
              LiabilityReturnDomesticOneEntityUkGaap:
                $ref: "#/components/examples/requests.UKTRLiabilityReturnDomesticOnlyOneEntityAndUkGaap"
              LiabilityReturnDomesticTwoEntities:
                $ref: "#/components/examples/requests.UKTRLiabilityReturnDomesticOnlyTwoEntities"
      responses:
        "201":
          description: UK Tax Return Submission Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.responses.UKTRSubmitSuccessResponse"
              examples:
                responses.UKTRSuccessResponseWithCRNExample:
                  $ref: "#/components/examples/responses.UKTRSuccessResponseWithCrnExample"
                responses.UKTRSuccessResponseWithoutCrnExample:
                  $ref: "#/components/examples/responses.UKTRSuccessResponseWithoutCrnExample"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Unauthorized:
                  $ref: "#/components/examples/errors.Submission.Unauthorized"
        "422":
          description: Business Validation Failure
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Invalid Pillar2ID:
                  value:
                    code: '002'
                    message: Pillar 2 ID missing or invalid
                Invalid Request:
                  value:
                    code: '003'
                    message: Request could not be processed
                Tax Obligation Fulfilled:
                  value:
                    code: '044'
                    message: Tax Obligation already fulfilled
                Duplicate Acknowledgment:
                  value:
                    code: '004'
                    message: Duplicate acknowledgment reference
                No Active Submission:
                  value:
                    code: '007'
                    message: Business Partner does not have an Active Pillar 2 registration
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: '003'
                message: Not authorized
  /organisations/pillar-two/overseas-return-notification:
    post:
      security:
      - userRestricted:
        - write:pillar2
      description: |
        Submit an Overseas Return Notification
      tags:
      - submission
      operationId: submitORN
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - accountingPeriodFrom
              - accountingPeriodTo
              - filedDateGIR
              - countryGIR
              - reportingEntityName
              - TIN
              - issuingCountryTIN
              properties:
                TIN:
                  type: string
                  minLength: 1
                  maxLength: 200
                countryGIR:
                  type: string
                  minLength: 1
                  maxLength: 2
                accountingPeriodFrom:
                  type: string
                  format: date
                reportingEntityName:
                  type: string
                  minLength: 1
                  maxLength: 200
                issuingCountryTIN:
                  type: string
                  minLength: 1
                  maxLength: 2
                filedDateGIR:
                  type: string
                  format: date
                accountingPeriodTo:
                  type: string
                  format: date
      parameters:
      - in: header
        name: X-Pillar2-Id
        schema:
          type: string
        description: Pillar2 ID for the submission. Mandatory if the user is an Agent
      - name: Authorization
        in: header
        description: Bearer token for authentication
        schema:
          type: string
        required: true
      - name: Accept
        in: header
        description: "Specifies the expected response format as versioned JSON from\
          \ the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        required: false
      summary: Submit Overseas Return Notification
      responses:
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Invalid Json:
                  $ref: "#/components/examples/errors.InvalidJson"
                Empty Request Body:
                  $ref: "#/components/examples/errors.EmptyBody"
                Missing Header:
                  value:
                    code: '005'
                    message: Missing Header in request
        "201":
          description: Overseas Return Notification Submission Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Forbidden:
                  $ref: "#/components/examples/errors.Submission.Forbidden"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Generic Server Error:
                  $ref: "#/components/examples/errors.Submission.GenericServerError"
                No Subscription Data:
                  value:
                    code: '004'
                    message: No Pillar2 subscription found for -pillar2Id
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: '006'
                message: Forbidden
        "422":
          description: Business Validation Failure
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Invalid Pillar2ID:
                  value:
                    code: '089'
                    message: ID number missing or invalid
                Invalid Return:
                  value:
                    code: '093'
                    message: Invalid Return
                Invalid Request:
                  value:
                    code: '003'
                    message: Request could not be processed
                Tax Obligation Fulfilled:
                  value:
                    code: '044'
                    message: Tax Obligation already fulfilled
                Duplicate Acknowledgment:
                  value:
                    code: '004'
                    message: Duplicate acknowledgment reference
                No Active Submission:
                  value:
                    code: '063'
                    message: Business Partner does not have an Active Subscription
                      for this Regime
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: '003'
                message: Not authorized
  /organisations/pillar-two/uk-tax-return:
    post:
      security:
      - userRestricted:
        - write:pillar2
    put:
      operationId: amendUKTR
      tags:
      - submission
      summary: AmendUKTR
      parameters:
      - in: header
        name: Authorization
        required: true
        schema:
          type: string
        description: Bearer token for authentication
      - in: header
        name: X-Pillar2-Id
        required: true
        schema:
          type: string
        description: Pillar2 ID for the submission
      - in: header
        name: Accept
        required: false
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        description: "Specifies the expected response format as versioned JSON from the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
              - $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.UKTRSubmissionData"
              - $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.UKTRSubmissionNilReturn"
            examples:
              NilReturnMneAndUk:
                $ref: "#/components/examples/requests.UKTRNilReturnMneAndUk"
              NilReturnDomesticOnlyWithUkGaap:
                $ref: "#/components/examples/requests.UKTRNilReturnDomesticOnlyWithUkGaap"
              NilReturnDomesticOnlyWithoutUkGaap:
                $ref: "#/components/examples/requests.UKTRNilReturnDomesticOnlyWithoutUkGaap"
              LiabilityReturnMneAndUkOneEntity:
                $ref: "#/components/examples/requests.UKTRLiabilityReturnMneAndUkWithOneEntity"
              LiabilityReturnMneAndUkTwoEntities:
                $ref: "#/components/examples/requests.UKTRLiabilityReturnMneAndUkWithTwoEntities"
              LiabilityReturnDomesticOneEntityUkGaap:
                $ref: "#/components/examples/requests.UKTRLiabilityReturnDomesticOnlyOneEntityAndUkGaap"
              LiabilityReturnDomesticTwoEntities:
                $ref: "#/components/examples/requests.UKTRLiabilityReturnDomesticOnlyTwoEntities"
      responses:
        "200":
          description: UK Tax Return Submission Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.responses.UKTRSubmitSuccessResponse"
              examples:
                responses.UKTRSuccessResponseWithCRNExample:
                  $ref: "#/components/examples/responses.UKTRSuccessResponseWithCrnExample"
                responses.UKTRSuccessResponseWithoutCrnExample:
                  $ref: "#/components/examples/responses.UKTRSuccessResponseWithoutCrnExample"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Unauthorized:
                  $ref: "#/components/examples/errors.Submission.Unauthorized"
        "422":
          description: Business Validation Failure
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Invalid UTPR Election:
                  value:
                    code: '095'
                    message: Invalid UTPR Election
                Invalid Pillar2ID:
                  value:
                    code: '002'
                    message: Pillar 2 ID missing or invalid
                Invalid Total Liability IIR:
                  $ref: "#/components/examples/errors.Submission.InvalidTotalLiabilityIIR"
                Invalid DTT Election:
                  $ref: "#/components/examples/errors.Submission.InvalidDTT"
                Invalid Return:
                  $ref: "#/components/examples/errors.Submission.InvalidReturn"
                Invalid Request:
                  value:
                    code: '003'
                    message: Request could not be processed
                Duplicate Submission:
                  value:
                    code: '004'
                    message: Duplicate submission acknowledgment reference
                Invalid Total Liability UTPR:
                  $ref: "#/components/examples/errors.Submission.InvalidTotalLiabilityUTPR"
                Invalid Total Liability:
                  value:
                    code: '096'
                    message: Invalid Total Liability
                Tax Obligation Fulfilled:
                  value:
                    code: '044'
                    message: Tax Obligation already fulfilled
                No Active Submission:
                  value:
                    code: '007'
                    message: Business Partner does not have an active subscription
                Invalid Total Liability DTT:
                  $ref: "#/components/examples/errors.Submission.InvalidTotalLiabilityDTT"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: '003'
                message: Not authorized
    put:
      security:
      - userRestricted:
        - write:pillar2
  /organisations/pillar-two/below-threshold-notification:
    post:
      operationId: submitBTN
      tags:
      - submission
      summary: SubmitBTN
      parameters:
      - in: header
        name: Authorization
        required: true
        schema:
          type: string
        description: Bearer token for authentication
      - in: header
        name: X-Pillar2-Id
        required: true
        schema:
          type: string
        description: Pillar2 ID for the submission
      - in: header
        name: Accept
        required: false
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        description: "Specifies the expected response format as versioned JSON from the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.belowthresholdnotification.BTNSubmission"
            examples:
              requests.BTNRequestExample:
                $ref: "#/components/examples/requests.BTNRequestExample"
      responses:
        "201":
          description: Below-Threshold Notification Submission Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.belowthresholdnotification.SubmitBTNSuccessResponse"
              examples:
                responses.BTNSuccessResponseExample:
                  $ref: "#/components/examples/responses.BTNSuccessResponseExample"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Unauthorized:
                  $ref: "#/components/examples/errors.Submission.Unauthorized"
        "422":
          description: Business Validation Failure
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Invalid UTPR Election:
                  value:
                    code: '095'
                    message: Invalid UTPR Election
                Invalid Pillar2ID:
                  value:
                    code: '002'
                    message: Pillar 2 ID missing or invalid
                Invalid Total Liability IIR:
                  value:
                    code: '097'
                    message: Invalid Total Liability IIR
                Invalid DTT Election:
                  value:
                    code: '094'
                    message: Invalid DTT Election
                Invalid Return:
                  value:
                    code: '093'
                    message: Invalid Return
                Invalid Request:
                  value:
                    code: '003'
                    message: Request could not be processed
                Duplicate Submission:
                  value:
                    code: '004'
                    message: Duplicate submission acknowledgment reference
                Invalid Total Liability UTPR:
                  value:
                    code: '099'
                    message: Invalid Total Liability UTPR
                Invalid Total Liability:
                  value:
                    code: '096'
                    message: Invalid Total Liability
                No Active Submission:
                  value:
                    code: '007'
                    message: Business Partner does not have an active subscription
                Invalid Total Liability DTT:
                  value:
                    code: '098'
                    message: Invalid Total Liability DTT
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Forbidden:
                  $ref: "#/components/examples/errors.Submission.Forbidden"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/responses.UKTRSubmitSuccessResponse"
  /organisations/pillar-two/obligations-and-submissions:
    get:
      security:
      - userRestricted:
        - write:pillar2
      description: |
        Submits a Below-Threshold Notification for a specified accounting period when the group no longer meets the threshold for the Pillar 2 top-up tax.
        ### Error Codes
        <p>This table contains a list of 422 error codes returned when a SubmitBTN API request is not processed successfully.</p>
        <table>
        <thead>
        <tr>
        <th>Error Message</th>
        <th>Next Steps</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td>003 - Request could not be processed</td>
        <td>The message could not be processed due to locking. Please check if there is currently an open enquiry on your tax account.</td>
        </tr>
        <tr>
        <td>025 - No associated data found</td>
        <td>No associated data found for this Pillar 2 ID.</td>
        </tr>
        <tr>
        </tbody>
        </table>
      security:
      - userRestricted:
        - write:pillar2
  /organisations/pillar-two/obligations-and-submissions:
    get:
      operationId: retrieveData
      tags:
      - submission
      parameters:
      - in: query
        name: fromDate
        required: true
        schema:
          type: string
      - in: query
        name: toDate
        required: true
        schema:
          type: string
      - name: Authorization
        in: header
        description: Bearer token for authentication
        schema:
          type: string
        description: Pillar2 ID for the submission. Mandatory if the user is an Agent
      - in: header
        name: Authorization
        required: true
        schema:
          type: string
        description: Bearer token for authentication
      - in: header
        name: Accept
        required: false
        schema:
          type: string
          example: application/vnd.hmrc.1.0+json
        description: "Specifies the expected response format as versioned JSON from the HMRC API (v1.0). If not provided, it will default to application/vnd.hmrc.1.0+json."
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.overseasreturnnotification.ORNSubmission"
      responses:
        "201":
          description: Overseas Return Notification Submission Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Generic Server Error:
                  value:
                    code: 500
                    message: Internal Server Error
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: '006'
                message: Forbidden
        "422":
          description: Business Validation Failure
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              examples:
                Invalid Pillar2ID:
                  value:
                    code: '002'
                    message: Pillar 2 ID missing or invalid
                Invalid Request:
                  value:
                    code: '003'
                    message: Request could not be processed
                Duplicate Acknowledgment:
                  value:
                    code: '004'
                    message: Duplicate acknowledgment reference
                No associated data found:
                  value:
                    code: '025'
                    message: No associated data found
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse"
              example:
                code: '003'
                message: Not authorized
        "200":
          description: OK Obligations and Submissions retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ObligationsAndSubmissionsSuccessResponse"
components:
  schemas:
    uk.gov.hmrc.pillar2submissionapi.models.overseasreturnnotification.ORNSuccessResponse:
      properties:
        processingDate:
          type: string
        formBundleNumber:
          type: string
      required:
      - processingDate
      - formBundleNumber
    uk.gov.hmrc.pillar2submissionapi.models.overseasreturnnotification.ORNSubmission:
      properties:
        accountingPeriodFrom:
          type: string
          format: date
        accountingPeriodTo:
          type: string
          format: date
      required:
      - accountingPeriodFrom
      - accountingPeriodTo
      - filedDateGIR
      - countryGIR
      - reportingEntityName
      - TIN
      - issuingCountryTIN
    uk.gov.hmrc.pillar2submissionapi.models.belowthresholdnotification.SubmitBTNSuccessResponse:
      properties:
        processingDate:
          type: string
      required:
      - processingDate
    uk.gov.hmrc.pillar2submissionapi.models.belowthresholdnotification.BTNSubmission:
      properties:
        accountingPeriodFrom:
          type: string
          format: date
        accountingPeriodTo:
          type: string
          format: date
      required:
      - accountingPeriodFrom
      - accountingPeriodTo
    uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.responses.UKTRSubmitSuccessResponse:
      properties:
        processingDate:
          type: string
          format: date-time
        formBundleNumber:
          type: string
        chargeReference:
          type: string
          nullable: true
      required:
      - processingDate
      - formBundleNumber
    uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.LiabilityNilReturn:
      properties:
        returnType:
          type: string
          enum:
          - NIL_RETURN
      required:
      - returnType
    uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.UKTRSubmissionNilReturn:
      properties:
        accountingPeriodFrom:
          type: string
          format: date
        accountingPeriodTo:
          type: string
          format: date
        obligationMTT:
          type: boolean
        electionUKGAAP:
          type: boolean
        liabilities:
          $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.LiabilityNilReturn"
      required:
      - accountingPeriodFrom
      - accountingPeriodTo
      - obligationMTT
      - electionUKGAAP
      - liabilities
    uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.LiableEntity:
      properties:
        ukChargeableEntityName:
          type: string
        idType:
          type: string
        idValue:
          type: string
        amountOwedDTT:
          type: number
          format: double
          minimum: 0
          maximum: 9.99999999999999E12
        amountOwedIIR:
          type: number
          format: double
          minimum: 0
          maximum: 9.99999999999999E12
        amountOwedUTPR:
          type: number
          format: double
          minimum: 0
          maximum: 9.99999999999999E12
      required:
      - ukChargeableEntityName
      - idType
      - idValue
      - amountOwedDTT
      - amountOwedIIR
      - amountOwedUTPR
    uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.LiabilityData:
      properties:
        electionDTTSingleMember:
          type: boolean
        electionUTPRSingleMember:
          type: boolean
        numberSubGroupDTT:
          type: integer
          format: int32
        numberSubGroupUTPR:
          type: integer
          format: int32
        totalLiability:
          type: number
          format: double
          minimum: 0
          maximum: 9.99999999999999E12
        totalLiabilityDTT:
          type: number
          format: double
          minimum: 0
          maximum: 9.99999999999999E12
        totalLiabilityIIR:
          type: number
          format: double
          minimum: 0
          maximum: 9.99999999999999E12
        totalLiabilityUTPR:
          type: number
          format: double
          minimum: 0
          maximum: 9.99999999999999E12
        liableEntities:
          type: array
          items:
            $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.LiableEntity"
      required:
      - electionDTTSingleMember
      - electionUTPRSingleMember
      - numberSubGroupDTT
      - numberSubGroupUTPR
      - totalLiability
      - totalLiabilityDTT
      - totalLiabilityIIR
      - totalLiabilityUTPR
      - liableEntities
    uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.UKTRSubmissionData:
      properties:
        accountingPeriodFrom:
          type: string
          format: date
        accountingPeriodTo:
          type: string
          format: date
        obligationMTT:
          type: boolean
        electionUKGAAP:
          type: boolean
        liabilities:
          $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.uktrsubmissions.LiabilityData"
      required:
      - accountingPeriodFrom
      - accountingPeriodTo
      - obligationMTT
      - electionUKGAAP
      - liabilities
    uk.gov.hmrc.pillar2submissionapi.models.response.Pillar2ErrorResponse:
      properties:
        code:
          type: string
        message:
          type: string
      required:
      - code
      - message
    uk.gov.hmrc.pillar2submissionapi.models.organisation.TestOrganisationWithId:
      properties:
        pillar2Id:
          type: string
        organisation:
          $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.organisation.TestOrganisation"
      required:
      - pillar2Id
      - organisation
    uk.gov.hmrc.pillar2submissionapi.models.organisation.AccountingPeriod:
      properties:
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
      required:
      - startDate
      - endDate
    uk.gov.hmrc.pillar2submissionapi.models.organisation.OrgDetails:
      properties:
        domesticOnly:
          type: boolean
        organisationName:
          type: string
        registrationDate:
          type: string
          format: date
      required:
      - domesticOnly
      - organisationName
      - registrationDate
    uk.gov.hmrc.pillar2submissionapi.models.organisation.TestOrganisation:
      properties:
        orgDetails:
          $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.organisation.OrgDetails"
        accountingPeriod:
          $ref: "#/components/schemas/uk.gov.hmrc.pillar2submissionapi.models.organisation.AccountingPeriod"
        lastUpdated:
          type: string
          format: date-time
      required:
      - orgDetails
      - accountingPeriod
      - lastUpdated
    Submission:
      properties:
        submissionType:
          type: string
          enum:
          - UKTR
          - ORN
          - BTN
          - GIR
        receivedDate:
          type: string
          format: date-time
        country:
          type: string
          nullable: true
      required:
      - submissionType
      - receivedDate
    AccountingPeriodDetails:
      properties:
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        dueDate:
          type: string
          format: date
        underEnquiry:
          type: boolean
        obligations:
          type: array
          items:
            $ref: "#/components/schemas/Obligation"
      required:
      - startDate
      - endDate
      - dueDate
      - underEnquiry
      - obligations
    Obligation:
      properties:
        obligationType:
          type: string
          enum:
          - Pillar2TaxReturn
          - GlobeInformationReturn
        status:
          type: string
          enum:
          - Open
          - Fulfilled
        canAmend:
          type: boolean
        submissions:
          type: array
          items:
            $ref: "#/components/schemas/Submission"
      required:
      - obligationType
      - status
      - canAmend
      - submissions
  securitySchemes:
    userRestricted:
      type: oauth2
      description: |
        HMRC supports OAuth 2.0 for authenticating user restricted API requests using an OAuth 2.0 Bearer Token in the AUTHORIZATION header.
        Please see the [developer hub](https://developer.service.hmrc.gov.uk/api-documentation/docs/authorisation/user-restricted-endpoints) for more details.
      flows:
        authorizationCode:
          authorizationUrl: https://api.service.hmrc.gov.uk/oauth/authorize
          tokenUrl: https://api.service.hmrc.gov.uk/oauth/token
          refreshUrl: https://api.service.hmrc.gov.uk/oauth/refresh
          scopes:
            read:pillar2: Read data related to Pillar2 subscription
            write:pillar2: Write data related to Pillar2 subscription
servers:
- url: https://test-api.service.hmrc.gov.uk
  description: Sandbox
- url: https://api.service.hmrc.gov.uk
  description: Production
