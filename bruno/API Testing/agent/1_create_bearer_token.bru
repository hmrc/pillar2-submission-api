meta {
  name: Create Bearer Token
  type: http
  seq: 1
}

post {
  url: http://localhost:8585/government-gateway/session/login
  body: json
  auth: none
}

headers {
  Content-Type: application/json
}

body:json {
  "credId": "123456789",
  "affinityGroup": "Organisation",
  "confidenceLevel": 200,
  "credentialStrength": "strong",
  "enrolments": [
    {
      "key": "HMRC-PILLAR2-ORG",
      "identifiers": [
        {
          "key": "PLRID",
          "value": "XEPLR5555551123"
        }
      ],
      "state": "Activated"
    }
  ]
}

script:post-response {
  let authHeader = res.headers.authorization
  let arr = authHeader.split(",")
  let bearer = ""
  if(arr[0].includes("Bearer"))
    bearer = arr[0]
  else
    bearer = arr[1]
  bru.setEnvVar("bearerToken",bearer)
}

// tests {
//   test("Status code is 201") {
//     expect(response.status).to.equal(201)
//   }
  
//   test("Bearer token exists") {
//     expect(response.headers.Authorization).to.exist
//   }
// }

// vars {
//   bearerToken: response.headers.Authorization
// } 